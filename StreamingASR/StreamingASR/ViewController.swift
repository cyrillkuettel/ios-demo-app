//// Copyright (c) 2020 Facebook, Inc. and its affiliates.
// All rights reserved.
//
// This source code is licensed under the BSD-style license found in the
// LICENSE file in the root directory of this source tree.



import UIKit
import AVFoundation
import Speech
import RosaKit


extension String {
    func stringByAppendingPathComponent(path: String) -> String {
        let s = self as NSString
        return s.appendingPathComponent(path)
    }
}


class ViewController: UIViewController, AVAudioRecorderDelegate {
    @IBOutlet weak var btnStart: UIButton!
    @IBOutlet weak var tvResult: UITextView!
    
    private var audioRecorder: AVAudioRecorder!
    private var _recorderFilePath: String!
    private var mListening: Bool!
    
    private let AUDIO_LEN_IN_SECOND = 6
    private let SAMPLE_RATE = 16000
    
    private let CHUNK_TO_READ = 5
    private let CHUNK_SIZE = 640
    private let SPECTROGRAM_X = 21
    private let SPECTROGRAM_Y = 80

    let audioEngine = AVAudioEngine()
    let recognitionRequest = SFSpeechAudioBufferRecognitionRequest()
    var recognitionTask: SFSpeechRecognitionTask?
    let speechRecognizer = SFSpeechRecognizer()
    


    private let module: InferenceModule = {
        if let filePath = Bundle.main.path(forResource:
            "streaming_asr", ofType: "ptl"),
            let module = InferenceModule(fileAtPath: filePath) {
            return module
        } else {
            fatalError("Can't find the model file!")
        }
    }()
    
    
    override func viewDidLoad() {
        super.viewDidLoad()
    }
    
    @IBAction func startTapped(_ sender: Any) {
        if (self.btnStart.title(for: .normal)! == "Start") {
            self.btnStart.setTitle("Listening... Stop", for: .normal)
            self.mListening = true
        
            SFSpeechRecognizer.requestAuthorization {
              [unowned self] (authStatus) in
              switch authStatus {
              case .authorized:
                do {
                  try self.startRecording()
                } catch let error {
                  print("There was a problem starting recording: \(error.localizedDescription)")
                }
              case .denied:
                print("Speech recognition authorization denied")
              case .restricted:
                print("Not available on this device")
              case .notDetermined:
                print("Not determined")
              }
            }
            
        }
        else {
            self.btnStart.setTitle("Start", for: .normal)
            self.mListening = false
            
            self.stopRecording()
        }
    }
        
}

extension ViewController {
  fileprivate func startRecording() throws {
      
    let node = audioEngine.inputNode
    let inputFormat = node.outputFormat(forBus: 0)
      
    let recordingFormat = AVAudioFormat(commonFormat: .pcmFormatFloat32, sampleRate: Double(SAMPLE_RATE), channels: 1, interleaved: false)
    let formatConverter =  AVAudioConverter(from:inputFormat, to: recordingFormat!)

    node.installTap(onBus: 0, bufferSize: 1024, format: inputFormat) { [unowned self]
                      (buffer, _) in
        
            
            let pcmBuffer = AVAudioPCMBuffer(pcmFormat: recordingFormat!, frameCapacity: AVAudioFrameCount(recordingFormat!.sampleRate))
            var error: NSError? = nil
            
            let inputBlock: AVAudioConverterInputBlock = {inNumPackets, outStatus in
              outStatus.pointee = AVAudioConverterInputStatus.haveData
              return buffer
            }
            
            formatConverter!.convert(to: pcmBuffer!, error: &error, withInputFrom: inputBlock)
            
//            if error != nil {
//              print(error!.localizedDescription)
//            }
//            else if let channelData = pcmBuffer!.int16ChannelData {
//
//              let channelDataPointer = channelData.pointee
//              let channelData = stride(from: 0,
//                                                 to: Int(pcmBuffer!.frameLength),
//                                                 by: buffer.stride).map{ channelDataPointer[$0] }
//                //Return channelDataValueArray
//
//
//          }
        
        var floatArray = Array(UnsafeBufferPointer(start: pcmBuffer!.floatChannelData![0], count:Int(pcmBuffer!.frameLength)))
        
        let rawAudioData = floatArray

        let chunkSize = 16000
        //let samples = Array(rawAudioData[0..<chunkSize]).map { Double($0)/32768.0 }
        let samples = [5.5549e-06,-5.1506e-06,-2.3338e-04,-4.0087e-04,-3.6283e-04,-6.6179e-05,-1.1754e-06,-4.4401e-05,2.4386e-06,-1.1178e-04,-8.4091e-05,-3.7550e-05,-1.1895e-04,-1.8160e-04,-3.7486e-05,-1.2145e-04,-1.6083e-04,7.8419e-06,-4.4802e-05,-1.8087e-05,1.2963e-04,2.7092e-04,2.3560e-04,2.9672e-04,2.3465e-04,2.3361e-04,3.0575e-04,1.5016e-04,9.5896e-05,3.2601e-05,1.3830e-04,1.6683e-04,2.3773e-05,4.4381e-05,1.4976e-04,8.4743e-05,-7.4959e-05,-2.1262e-05,2.8756e-05,-1.0834e-05,-5.4295e-05,-2.3075e-06,1.8652e-05,-1.0116e-04,-6.9382e-05,-5.9171e-05,-6.4040e-05,-1.1863e-04,-1.9846e-04,-6.3885e-05,-4.1042e-05,-1.2372e-04,-1.4174e-04,-2.1780e-04,-2.9005e-04,-2.9658e-04,-2.4914e-04,-1.9496e-04,-1.3682e-04,-3.0033e-05,1.9315e-06,8.7270e-06,-5.2442e-06,-5.2831e-05,-9.2842e-05,-1.7221e-04,-1.5605e-04,-9.8457e-05,-1.5081e-04,-8.0053e-05,-4.7450e-05,-1.0614e-06,6.6542e-05,5.6456e-05,2.4752e-04,2.4126e-04,1.9878e-04,2.0452e-04,1.8219e-04,2.3312e-04,1.6917e-04,1.7160e-04,3.1545e-04,4.3977e-04,3.7682e-04,2.7866e-04,2.6091e-04,1.6284e-04,1.3738e-04,1.7323e-04,8.3838e-05,3.4434e-05,9.3887e-05,8.9931e-05,6.4358e-05,1.0424e-04,1.1881e-04,9.8433e-05,-2.8536e-06,6.5878e-06,-4.2046e-05,-1.7404e-04,-1.4337e-04,-1.0063e-04,1.5633e-06,-3.3320e-05,-1.3007e-04,-1.4385e-04,-2.0446e-04,-1.3620e-04,-1.1842e-04,-1.1467e-04,3.4656e-05,-3.0873e-05,-6.8715e-05,1.3477e-05,-4.1023e-05,5.1521e-05,1.2572e-04,4.2747e-05,1.8502e-04,2.9493e-04,3.8798e-04,3.6327e-04,1.4730e-04,1.4424e-04,1.4511e-04,9.1790e-05,7.9021e-06,-3.5834e-05,-9.4959e-05,-1.1305e-04,-4.2009e-05,3.5169e-05,2.7812e-05,-1.1744e-04,4.0272e-06,1.1580e-04,1.2599e-04,1.8317e-04,1.3756e-04,1.9262e-04,1.6747e-04,1.2447e-04,1.8979e-04,6.7112e-05,-1.0929e-04,-5.4176e-05,-8.1322e-05,-1.0542e-04,1.6328e-05,-5.2606e-05,-3.7499e-05,-1.5041e-04,-1.7322e-04,-2.2157e-04,-1.5396e-04,6.3010e-05,-5.1621e-05,-1.7191e-05,-1.6113e-05,2.5601e-05,6.9941e-05,1.8701e-05,1.5231e-05,-6.7660e-05,-1.3221e-04,-1.6256e-04,-1.8240e-04,-1.7448e-04,-1.3470e-04,-1.1703e-04,-9.7918e-05,-8.5530e-05,-7.6844e-05,-7.1587e-05,-6.9691e-05,-6.7144e-05,-6.7637e-05,-6.4545e-05,-6.1516e-05,-6.0744e-05,-5.6577e-05,-5.2689e-05,-5.0864e-05,-4.6182e-05,-4.2164e-05,-3.7131e-05,-3.5776e-05,-3.3765e-05,-3.2891e-05,-3.6626e-05,-3.3995e-05,-3.3547e-05,-3.3759e-05,-3.2454e-05,-3.1284e-05,-2.8632e-05,-2.5490e-05,-2.2164e-05,-2.0237e-05,-1.8043e-05,-1.6888e-05,-1.6841e-05,-1.6700e-05,-1.6568e-05,-1.6420e-05,-1.6264e-05,-1.6104e-05,-1.5933e-05,-1.5759e-05,-1.5575e-05,-1.5386e-05,-1.5191e-05,-1.4990e-05,-1.4786e-05,-1.4576e-05,-1.4363e-05,-1.4146e-05,-1.3927e-05,-1.3705e-05,-1.3482e-05,-1.3257e-05,-1.3030e-05,-1.2803e-05,-1.2575e-05,-1.2347e-05,-1.2118e-05,-1.1890e-05,-1.1662e-05,-1.1435e-05,-1.1209e-05,-1.0983e-05,-1.0759e-05,-1.0536e-05,-1.0314e-05,-1.0094e-05,-9.8749e-06,-9.6577e-06,-9.4423e-06,-9.2285e-06,-9.0166e-06,-8.8066e-06,-8.5984e-06,-8.3922e-06,-8.1879e-06,-7.9855e-06,-7.7850e-06,-7.5865e-06,-7.3899e-06,-7.1953e-06,-7.0025e-06,-6.8116e-06,-6.6225e-06,-6.4353e-06,-6.2498e-06,-6.0661e-06,-5.8842e-06,-5.7039e-06,-5.5253e-06,-5.3484e-06,-5.1729e-06,-4.9991e-06,-4.8267e-06,-4.6557e-06,-4.4862e-06,-4.3181e-06,-4.1512e-06,-3.9857e-06,-3.8214e-06,-3.6583e-06,-3.4964e-06,-3.3356e-06,-3.1759e-06,-3.0172e-06,-2.8595e-06,-2.7028e-06,-2.5471e-06,-2.3922e-06,-2.2383e-06,-2.0852e-06,-1.9330e-06,-1.7815e-06,-1.6309e-06,-1.4810e-06,-1.3317e-06,-1.1839e-06,-1.0370e-06,-8.8872e-07,-7.4302e-07,-5.9842e-07,-4.5189e-07,-3.0539e-07,-1.6008e-07,-1.1851e-08,1.3478e-07,2.7589e-07,4.1785e-07,5.5365e-07,6.9390e-07,8.3057e-07,9.5933e-07,1.0915e-06,1.2246e-06,1.3625e-06,1.4964e-06,1.6220e-06,1.7545e-06,1.8925e-06,2.0201e-06,2.1458e-06,2.2794e-06,2.4121e-06,2.5426e-06,2.6724e-06,2.8036e-06,2.9323e-06,3.0592e-06,3.1864e-06,3.3121e-06,3.4365e-06,3.5589e-06,3.6791e-06,3.7927e-06,3.8984e-06,3.9990e-06,4.0961e-06,4.1917e-06,4.2869e-06,4.3819e-06,4.4774e-06,4.5729e-06,4.6688e-06,4.7659e-06,4.8634e-06,4.9631e-06,5.0644e-06,5.1662e-06,5.2725e-06,5.3816e-06,5.4899e-06,5.5966e-06,5.7023e-06,5.8085e-06,5.9131e-06,6.0186e-06,6.1212e-06,6.2211e-06,6.3200e-06,6.4183e-06,6.5144e-06,6.6065e-06,6.6971e-06,6.7832e-06,6.8648e-06,6.9440e-06,7.0189e-06,7.0900e-06,7.1579e-06,7.2223e-06,7.2840e-06,7.3430e-06,7.3994e-06,7.4539e-06,7.5064e-06,7.5570e-06,7.6056e-06,7.6522e-06,7.6969e-06,7.7396e-06,7.7802e-06,7.8189e-06,7.8556e-06,7.8903e-06,7.9229e-06,7.9536e-06,7.9823e-06,8.0090e-06,8.0337e-06,8.0563e-06,8.0770e-06,8.0957e-06,8.1124e-06,8.1272e-06,8.1400e-06,8.1508e-06,8.1597e-06,8.1666e-06,8.1716e-06,8.1747e-06,8.1758e-06,8.1750e-06,8.1724e-06,8.1678e-06,8.1614e-06,8.1531e-06,8.1430e-06,8.1311e-06,8.1174e-06,8.1018e-06,8.0845e-06,8.0654e-06,8.0446e-06,8.0221e-06,7.9979e-06,7.9720e-06,7.9444e-06,7.9152e-06,7.8844e-06,7.8520e-06,7.8180e-06,7.7823e-06,7.7452e-06,7.7066e-06,7.6665e-06,7.6249e-06,7.5819e-06,7.5373e-06,7.4914e-06,7.4441e-06,7.3956e-06,7.3457e-06,7.2943e-06,7.2418e-06,7.1881e-06,7.1330e-06,7.0768e-06,7.0194e-06,6.9609e-06,6.9012e-06,6.8404e-06,6.7786e-06,6.7156e-06,6.6517e-06,6.5868e-06,6.5209e-06,6.4540e-06,6.3865e-06,6.3174e-06,6.2482e-06,6.1772e-06,6.1070e-06,6.0245e-06,5.8878e-06,5.7041e-06,5.5292e-06,5.3682e-06,5.2529e-06,5.2466e-06,5.3252e-06,5.3973e-06,5.4850e-06,5.5823e-06,5.5873e-06,5.5162e-06,5.2793e-06,4.8828e-06,4.4012e-06,3.8533e-06,3.2703e-06,2.7265e-06,2.3347e-06,1.9248e-06,1.6470e-06,1.5282e-06,1.2244e-06,8.6336e-07,4.6820e-07,-1.5702e-07,-1.0634e-06,-2.1880e-06,-3.5680e-06,-5.0285e-06,-6.5030e-06,-8.0151e-06,-9.3486e-06,-1.0362e-05,-1.1043e-05,-1.1954e-05,-1.3094e-05,-1.4444e-05,-1.7265e-05,-2.1627e-05,-2.8119e-05,-3.7219e-05,-4.9608e-05,-6.5792e-05,-8.5342e-05,-1.1205e-04,-1.4623e-04,-1.8266e-04,-2.1929e-04,-2.5853e-04,-2.9903e-04,-3.3649e-04,-3.7280e-04,-4.1235e-04,-4.4763e-04,-4.7558e-04,-5.0298e-04,-5.2557e-04,-5.5008e-04,-5.7481e-04,-5.9505e-04,-6.1370e-04,-6.3089e-04,-6.4884e-04,-6.5843e-04,-6.7385e-04,-6.8060e-04,-6.8317e-04,-6.9631e-04,-7.0031e-04,-7.0135e-04,-7.0226e-04,-7.0335e-04,-7.0133e-04,-7.0100e-04,-6.9412e-04,-6.9000e-04,-6.9146e-04,-6.8647e-04,-6.7298e-04,-6.4979e-04,-6.4918e-04,-6.3513e-04,-6.0178e-04,-6.0076e-04,-5.8417e-04,-5.6083e-04,-5.4438e-04,-5.1809e-04,-5.0457e-04,-4.8722e-04,-4.6231e-04,-4.3628e-04,-4.0539e-04,-3.8340e-04,-3.5909e-04,-3.4270e-04,-3.1644e-04,-2.9440e-04,-2.8729e-04,-2.6020e-04,-2.3499e-04,-1.9656e-04,-1.5648e-04,-1.3300e-04,-9.7652e-05,-8.6845e-05,-6.4764e-05,-1.5028e-05,6.3489e-06,3.4957e-05,5.7125e-05,9.5025e-05,1.3167e-04,1.4499e-04,1.7237e-04,1.9298e-04,2.2173e-04,2.4372e-04,2.5655e-04,2.9473e-04,3.1506e-04,3.4782e-04,3.6950e-04,3.9016e-04,4.2349e-04,4.4426e-04,4.9959e-04,5.3081e-04,5.5205e-04,5.8301e-04,5.7302e-04,5.8222e-04,6.2095e-04,6.2492e-04,6.5857e-04,6.8794e-04,7.1655e-04,7.7108e-04,7.5997e-04,7.7646e-04,8.0058e-04,7.9386e-04,8.2402e-04,8.3252e-04,8.3943e-04,8.3973e-04,8.4826e-04,8.7737e-04,9.0186e-04,9.2014e-04,8.9532e-04,9.1045e-04,9.1062e-04,8.9970e-04,9.2579e-04,9.6621e-04,1.0023e-03,1.0355e-03,1.0641e-03,1.0778e-03,1.0722e-03,1.0755e-03,1.0938e-03,1.0597e-03,1.0514e-03,1.0629e-03,1.0468e-03,1.0393e-03,1.0242e-03,1.0209e-03,1.0385e-03,1.0349e-03,1.0299e-03,1.0537e-03,1.0634e-03,1.0878e-03,1.1018e-03,1.0781e-03,1.0888e-03,1.1206e-03,1.0611e-03,1.0275e-03,1.0222e-03,1.0070e-03,1.0148e-03,1.0061e-03,1.0223e-03,1.0029e-03,1.0055e-03,1.0026e-03,1.0089e-03,9.6659e-04,9.1305e-04,9.0198e-04,8.5142e-04,8.4266e-04,8.5400e-04,8.1564e-04,8.4358e-04,8.3909e-04,8.2905e-04,8.8158e-04,7.9120e-04,7.3787e-04,7.2960e-04,6.7340e-04,6.8796e-04,6.7737e-04,6.3963e-04,6.3977e-04,6.0025e-04,5.8658e-04,5.6291e-04,5.6716e-04,5.5746e-04,4.6358e-04,4.6224e-04,4.0324e-04,3.7171e-04,4.2490e-04,3.9544e-04,3.6207e-04,3.3365e-04,3.0801e-04,3.5545e-04,3.7192e-04,2.9209e-04,3.1455e-04,2.8775e-04,1.8626e-04,2.0636e-04,1.7461e-04,1.1499e-04,1.0412e-04,7.5233e-05,7.4018e-06,-4.6612e-05,-3.1015e-06,-1.1492e-05,-2.6470e-05,-2.3196e-05,-5.2122e-07,-5.2288e-05,-7.6182e-05,-7.4396e-05,-1.4273e-04,-1.5659e-04,-1.3987e-04,-1.4290e-04,-2.1911e-04,-1.6977e-04,-1.4534e-04,-2.8216e-04,-3.0439e-04,-2.9134e-04,-3.1149e-04,-2.8266e-04,-2.6932e-04,-3.3549e-04,-3.7726e-04,-4.1031e-04,-4.5646e-04,-4.8512e-04,-5.2850e-04,-5.3493e-04,-5.1623e-04,-4.7249e-04,-5.0404e-04,-5.3317e-04,-5.3365e-04,-5.5621e-04,-5.9749e-04,-6.5372e-04,-6.6870e-04,-6.5063e-04,-6.2025e-04,-6.3144e-04,-6.6663e-04,-6.7378e-04,-6.7999e-04,-6.6314e-04,-7.1135e-04,-7.9968e-04,-8.5645e-04,-8.9625e-04,-9.0409e-04,-9.1688e-04,-9.1992e-04,-8.9406e-04,-8.9733e-04,-8.9160e-04,-8.8873e-04,-8.6695e-04,-9.2796e-04,-1.0573e-03,-1.0039e-03,-9.4627e-04,-1.0065e-03,-1.0386e-03,-9.9865e-04,-1.0225e-03,-1.0622e-03,-1.0758e-03,-1.0644e-03,-9.8942e-04,-9.7660e-04,-1.0131e-03,-9.8973e-04,-9.3870e-04,-9.0159e-04,-9.4961e-04,-1.0469e-03,-1.0098e-03,-9.8058e-04,-9.5248e-04,-9.5682e-04,-9.8604e-04,-9.2668e-04,-9.1920e-04,-9.8983e-04,-9.6266e-04,-1.0218e-03,-1.0087e-03,-8.5621e-04,-1.0059e-03,-1.0108e-03,-9.0845e-04,-1.0098e-03,-1.0364e-03,-1.0588e-03,-1.0733e-03,-1.1285e-03,-1.1034e-03,-1.0549e-03,-9.4160e-04,-8.2578e-04,-8.4875e-04,-8.0587e-04,-8.5381e-04,-9.4502e-04,-9.5551e-04,-9.4560e-04,-9.9593e-04,-9.8540e-04,-9.4479e-04,-9.3205e-04,-8.3558e-04,-7.5512e-04,-7.8540e-04,-9.2538e-04,-9.0341e-04,-8.2612e-04,-8.4673e-04,-8.6995e-04,-8.8727e-04,-8.9543e-04,-8.4177e-04,-7.9299e-04,-8.5778e-04,-8.5856e-04,-7.9260e-04,-7.8391e-04,-8.2346e-04,-8.2117e-04,-7.6734e-04,-6.9827e-04,-6.7137e-04,-6.8928e-04,-6.7860e-04,-7.1164e-04,-6.6463e-04,-5.8776e-04,-5.9132e-04,-5.4547e-04,-5.7813e-04,-5.5866e-04,-5.2478e-04,-6.6027e-04,-6.0593e-04,-4.6089e-04,-4.6621e-04,-4.6801e-04,-5.0015e-04,-5.3481e-04,-5.2230e-04,-5.7891e-04,-5.4444e-04,-4.4621e-04,-5.0031e-04,-5.6872e-04,-5.3880e-04,-5.3811e-04,-5.8111e-04,-5.1552e-04,-4.4434e-04,-3.6992e-04,-2.3246e-04,-2.0487e-04,-3.1932e-04,-3.0033e-04,-2.4205e-04,-1.9508e-04,-1.2005e-04,-1.0523e-04,-3.3271e-05,4.4724e-05,6.4314e-05,5.7338e-05,1.3298e-04,6.4645e-05,-1.3672e-04,-2.2788e-04,-1.3759e-04,-5.2130e-05,-1.3292e-04,-4.6473e-06,7.3939e-05,2.6222e-05,1.7502e-04,6.7174e-05,1.0341e-05,1.5217e-04,4.3208e-05,4.0473e-05,1.2323e-04,1.7227e-04,7.1426e-05,7.4952e-05,8.8701e-05,7.4605e-05,2.3268e-04,2.0273e-04,1.8608e-04,2.2751e-04,2.3899e-04,2.2841e-04,2.4024e-04,2.1385e-04,2.2899e-04,3.5388e-04,4.6204e-04,5.2570e-04,4.4009e-04,3.2731e-04,3.1291e-04,4.1832e-04,4.5296e-04,5.1634e-04,4.9597e-04,4.0493e-04,4.1717e-04,5.3929e-04,5.9162e-04,4.7569e-04,5.1367e-04,5.0052e-04,4.2369e-04,3.8612e-04,3.3525e-04,3.0451e-04,2.7305e-04,3.1628e-04,3.2151e-04,2.9797e-04,2.7233e-04,2.5369e-04,2.2737e-04,8.7467e-05,1.3419e-04,2.9918e-05,1.2335e-05,-3.2520e-05,-1.1037e-04,-4.4476e-05,1.1014e-04,2.1760e-04,5.3143e-06,9.2350e-05,1.9747e-04,1.8079e-04,2.8091e-04,3.0108e-04,1.6918e-04,1.9910e-04,3.3192e-04,2.4868e-04,3.4748e-04,4.7596e-04,4.7380e-04,5.2993e-04,6.9737e-04,7.6613e-04,7.8469e-04,7.4098e-04,7.2202e-04,7.2580e-04,5.9925e-04,6.0890e-04,5.8838e-04,5.7236e-04,5.8757e-04,6.6067e-04,7.2855e-04,8.3285e-04,9.1958e-04,8.8932e-04,9.7386e-04,9.7341e-04,8.2337e-04,8.4532e-04,8.8110e-04,6.5861e-04,5.4552e-04,7.6381e-04,7.4968e-04,7.9397e-04,8.3812e-04,8.3238e-04,9.9105e-04,7.9327e-04,7.4963e-04,9.0502e-04,9.5219e-04,8.3804e-04,5.9560e-04,6.3050e-04,6.6254e-04,6.8012e-04,6.3646e-04,6.1052e-04,5.5032e-04,4.6911e-04,6.8205e-04,7.5010e-04,6.9496e-04,5.3519e-04,6.4566e-04,7.5892e-04,6.6566e-04,7.0950e-04,5.5884e-04,4.2909e-04,3.8530e-04,4.9601e-04,4.1359e-04,4.8642e-04,7.8079e-04,6.3189e-04,6.3408e-04,7.0414e-04,6.7903e-04,6.6276e-04,4.9949e-04,4.4842e-04,4.9271e-04,4.6483e-04,5.5455e-04,7.2486e-04,7.5446e-04,7.3643e-04,7.2510e-04,7.3455e-04,6.0513e-04,4.4177e-04,6.0658e-04,6.3384e-04,7.0648e-04,7.6249e-04,7.3142e-04,8.3003e-04,6.8352e-04,6.3135e-04,5.4797e-04,4.6973e-04,4.0168e-04,4.4037e-04,5.8141e-04,6.6121e-04,7.3646e-04,6.4845e-04,7.7283e-04,6.4689e-04,3.5503e-04,5.2106e-04,3.5586e-04,1.8224e-04,4.0225e-04,3.3065e-04,2.9407e-04,1.3640e-04,1.4679e-04,3.7636e-04,2.6740e-04,1.8301e-04,9.1107e-05,4.2986e-04,4.4249e-04,6.6039e-05,1.7983e-04,2.0283e-04,3.2595e-04,4.1755e-04,2.9706e-04,3.7464e-04,5.8867e-04,5.0929e-04,2.8686e-04,2.5535e-04,9.2538e-05,1.0159e-04,2.4183e-04,1.6304e-04,1.9951e-04,2.6127e-04,2.1900e-04,2.6828e-04,3.4830e-04,4.4881e-04,4.9786e-04,3.8357e-04,3.3198e-04,1.8861e-04,1.5686e-04,1.9923e-04,1.6943e-04,2.4801e-04,1.0401e-04,6.7209e-05,9.1691e-05,1.7826e-04,2.9844e-04,4.4031e-04,3.8255e-04,1.8894e-04,3.1641e-04,2.6124e-04,9.8168e-05,5.7584e-05,-8.0143e-05,-2.3526e-04,-1.1316e-04,-4.7061e-05,1.4036e-04,3.8883e-04,4.2939e-04,5.0639e-04,4.0509e-04,2.5164e-04,2.6362e-04,3.5563e-04,4.0722e-04,3.5071e-04,1.9954e-04,2.0841e-05,8.2172e-05,1.5341e-04,4.3638e-05,1.1037e-04,2.4511e-04,2.1418e-04,1.5452e-04,-1.2958e-05,-2.4173e-04,-9.4188e-05,3.6884e-05,-1.7393e-04,-2.0703e-04,-1.5394e-04,-7.3875e-05,-2.8390e-05,4.5878e-05,2.7301e-04,2.4254e-04,7.4127e-06,-1.3995e-04,-1.2590e-04,-1.9995e-04,-1.6988e-04,-5.7177e-05,6.4052e-05,2.5487e-04,3.2301e-04,4.9636e-04,3.0725e-04,-1.0224e-04,-3.9060e-05,2.1515e-04,6.8281e-05,8.5719e-05,8.3907e-05,-1.3721e-04,5.6442e-05,1.8802e-04,2.0163e-04,1.7507e-04,1.1082e-04,6.2274e-05,-5.1696e-05,-5.6997e-05,-1.1329e-04,-2.9932e-04,-4.4400e-04,-3.7066e-04,-2.9163e-04,-2.6459e-04,-1.5669e-04,-1.1435e-04,-2.1634e-04,-3.0256e-04,-4.4352e-04,-6.8789e-04,-6.6811e-04,-7.0010e-04,-7.6373e-04,-6.4049e-04,-5.6560e-04,-5.8827e-04,-7.7321e-04,-7.4117e-04,-6.5776e-04,-5.9212e-04,-4.3094e-04,-7.1071e-04,-7.7113e-04,-6.1155e-04,-8.7211e-04,-8.8611e-04,-8.4167e-04,-8.7294e-04,-8.3918e-04,-8.9915e-04,-8.6903e-04,-7.9703e-04,-8.5005e-04,-9.8798e-04,-9.0603e-04,-8.6028e-04,-9.6032e-04,-8.9276e-04,-8.4444e-04,-7.8733e-04,-7.8567e-04,-7.3113e-04,-6.6748e-04,-6.9593e-04,-6.1079e-04,-6.1341e-04,-7.7335e-04,-7.7081e-04,-8.1616e-04,-8.9007e-04,-8.3585e-04,-8.6023e-04,-7.1314e-04,-7.2242e-04,-8.4165e-04,-7.7680e-04,-8.5474e-04,-9.5925e-04,-7.4694e-04,-7.3817e-04,-9.3707e-04,-9.5211e-04,-1.0033e-03,-9.4034e-04,-9.7105e-04,-1.0270e-03,-9.7950e-04,-1.0158e-03,-1.0613e-03,-1.2088e-03,-1.1918e-03,-1.0686e-03,-1.0126e-03,-1.0949e-03,-1.0380e-03,-1.0386e-03,-1.0145e-03,-9.1178e-04,-9.4455e-04,-9.4034e-04,-1.0960e-03,-1.0003e-03,-8.5051e-04,-8.5439e-04,-8.1402e-04,-8.1792e-04,-8.0592e-04,-7.6341e-04,-6.7838e-04,-8.6153e-04,-8.1954e-04,-6.6441e-04,-6.9650e-04,-6.3659e-04,-7.0468e-04,-6.4435e-04,-4.8542e-04,-4.1016e-04,-4.0987e-04,-2.7453e-04,-2.6315e-04,-5.7878e-04,-3.3034e-04,-1.0789e-04,-3.7444e-04,-4.9520e-04,-5.6667e-04,-4.5090e-04,-1.9627e-04,-1.1458e-04,8.0729e-05,2.2056e-04,2.4878e-05,-1.3462e-04,-1.1633e-04,-1.4901e-05,-1.7733e-05,5.1749e-05,-5.9448e-05,-1.4457e-04,-4.7433e-05,-1.9938e-05,3.4081e-05,2.2878e-04,3.0958e-04,1.7738e-04,1.4850e-04,1.7695e-04,3.4152e-04,3.1258e-04,4.7762e-05,-1.6215e-05,-3.5595e-05,5.9399e-06,-1.9003e-07,-2.1917e-05,-5.9148e-05,-9.9143e-05,-5.2386e-05,-2.6993e-04,-1.2219e-04,1.7300e-04,9.9751e-05,5.0422e-05,1.8623e-04,2.9730e-04,-3.3697e-05,-5.1576e-05,2.2104e-04,2.7173e-04,9.4183e-05,-1.2723e-04,5.0339e-05,1.8892e-04,3.5352e-04,5.2171e-04,5.6322e-04,3.8656e-04,3.2437e-04,6.0220e-04,5.8083e-04,4.2812e-04,2.6792e-04,2.4403e-04,4.5721e-04,4.7895e-04,5.0389e-04,4.0130e-04,2.6551e-04,3.5338e-04,3.5748e-04,3.4933e-04,4.1437e-04,3.4356e-04,2.2843e-04,3.9611e-04,4.6433e-04,5.7642e-04,6.0418e-04,3.0457e-04,1.5123e-04,1.7108e-04,2.0784e-04,1.3609e-04,2.1171e-04,2.9775e-04,2.5008e-04,3.7789e-04,5.5382e-04,5.7381e-04,3.7131e-04,1.8418e-04,2.5989e-04,1.8591e-04,1.8862e-04,3.0418e-04,2.3200e-04,1.4770e-04,3.0538e-04,5.2335e-04,4.8330e-04,5.1909e-04,3.0180e-04,2.1951e-04,1.7033e-04,1.2159e-04,3.2615e-04,3.0286e-04,3.4986e-04,4.4523e-04,2.5467e-04,1.1279e-04,2.8395e-04,3.9015e-04,2.9880e-04,2.8413e-04,3.9188e-04,4.8899e-04,4.0530e-04,6.0474e-04,6.9860e-04,6.4980e-04,6.9948e-04,7.1767e-04,8.7819e-04,8.9308e-04,9.3261e-04,8.8662e-04,8.3214e-04,8.8908e-04,7.4833e-04,6.3982e-04,6.6069e-04,8.1089e-04,6.5100e-04,6.1565e-04,8.2209e-04,8.2317e-04,8.3513e-04,6.4592e-04,4.4385e-04,3.2727e-04,2.2573e-04,2.7230e-04,3.1465e-04,3.7001e-04,2.8183e-04,8.0606e-05,7.3028e-05,8.1971e-05,9.0057e-05,1.6582e-04,5.6006e-05,4.8836e-05,8.1106e-05,1.5919e-04,4.0130e-04,3.4954e-04,3.2892e-04,3.6605e-04,3.6030e-04,4.0587e-04,3.7771e-04,2.8524e-04,4.7865e-04,6.8782e-04,7.4528e-04,7.2148e-04,5.4472e-04,5.5963e-04,5.7980e-04,5.7073e-04,3.3366e-04,3.0010e-04,5.2925e-04,5.4254e-04,4.5555e-04,4.6858e-04,3.5212e-04,5.5751e-05,1.2972e-04,1.1542e-04,-2.6613e-06,1.9605e-04,2.7453e-04,2.6301e-04,2.3840e-04,5.8758e-05,1.0143e-04,1.1728e-04,2.3848e-05,5.7826e-05,-2.4189e-05,-2.1789e-05,2.0077e-05,3.7124e-05,2.3103e-05,-6.7303e-05,-2.0362e-04,-3.9284e-04,-5.3625e-04,-4.2041e-04,-2.7631e-04,-4.9513e-04,-3.3426e-04,3.1255e-05,2.1647e-05,-1.4560e-04,-3.6432e-04,-4.8888e-04,-5.0649e-04,-4.8200e-04,-2.4048e-04,4.4206e-05,4.3192e-05,1.1498e-04,1.6435e-04,7.5068e-05,1.6439e-05,-5.9427e-06,-2.3837e-04,-4.9173e-04,-4.4345e-04,-4.6031e-04,-3.7543e-04,-1.9526e-04,-1.8626e-04,-3.8218e-04,-5.7210e-04,-5.1439e-04,-5.5147e-04,-6.7822e-04,-5.0151e-04,-3.5063e-04,-1.8521e-04,9.2724e-05,1.0134e-04,-8.2234e-05,-3.6868e-04,-4.9887e-04,-6.1739e-04,-8.3354e-04,-7.7321e-04,-7.1012e-04,-6.7212e-04,-2.9184e-04,-2.0110e-05,-1.2895e-04,-2.1813e-04,-3.0498e-04,-4.2248e-04,-4.9621e-04,-5.9429e-04,-7.6456e-04,-7.9129e-04,-5.7299e-04,-5.4139e-04,-6.3265e-04,-3.9012e-04,-2.4820e-04,-5.1163e-04,-6.4073e-04,-7.3905e-04,-6.3839e-04,-6.8623e-04,-9.3239e-04,-7.0373e-04,-6.2510e-04,-7.3122e-04,-6.9614e-04,-5.0662e-04,-2.9688e-04,-3.5409e-04,-3.3936e-04,-3.1343e-04,-2.2165e-04,-1.7472e-04,-2.3459e-04,-3.0942e-04,-3.3423e-04,-3.4348e-04,-4.9794e-04,-3.6591e-04,-2.1100e-04,-3.0657e-04,-3.6507e-04,-2.4003e-04,1.1659e-04,7.7058e-05,-5.5976e-05,4.2073e-05,-6.1954e-05,3.6280e-07,1.1795e-04,-1.2682e-04,-2.2046e-04,-1.5471e-04,-9.3251e-05,-3.1494e-05,-1.0953e-04,4.7694e-05,6.4719e-05,7.1877e-05,1.2522e-04,4.8056e-05,-2.2033e-05,-9.1235e-05,-2.2825e-04,-1.3725e-04,2.8883e-05,1.0984e-04,1.2776e-04,5.0075e-05,3.6163e-05,1.1252e-04,1.0179e-04,-1.0498e-05,1.0529e-04,1.5308e-05,6.2111e-05,1.5183e-04,1.6201e-04,2.6391e-04,8.0726e-05,-1.1088e-04,-1.7539e-04,-1.3469e-04,9.0286e-06,7.1536e-05,1.4532e-04,2.2557e-04,1.4279e-04,5.2565e-05,1.1825e-04,1.3657e-04,6.2322e-05,1.4237e-04,1.8696e-05,5.5796e-05,2.7024e-04,7.8959e-05,1.7480e-04,3.7723e-04,2.1746e-04,8.4990e-05,1.0965e-04,2.7523e-04,2.4959e-04,2.8856e-04,4.6505e-04,5.3489e-04,6.0238e-04,6.1898e-04,5.6725e-04,4.3680e-04,1.6740e-04,-1.1503e-04,-2.2230e-04,-1.6060e-04,5.0289e-06,7.9506e-05,3.5870e-05,1.6335e-04,1.9542e-04,4.8448e-05,5.7120e-05,1.2330e-04,6.2226e-05,-3.4235e-05,-4.6044e-06,8.3375e-05,1.6155e-04,1.3054e-04,2.0086e-04,3.3119e-04,3.1947e-04,4.1676e-04,3.4424e-04,2.8154e-04,3.0713e-04,2.0995e-04,2.2231e-04,2.5605e-04,3.6288e-04,3.3369e-04,2.2250e-04,3.1350e-04,2.9274e-04,-8.2938e-05,-1.1058e-04,7.3656e-05,-1.1974e-04,-1.6025e-04,-4.1179e-05,-8.9108e-05,-2.4144e-04,-2.8363e-04,-2.4622e-04,-1.6230e-04,-1.4603e-04,-1.7594e-04,7.9777e-05,2.2312e-04,2.0661e-04,2.6911e-04,2.5162e-04,1.3543e-04,5.8982e-05,3.0548e-04,2.2523e-04,8.4479e-05,4.0714e-04,4.1661e-04,2.1044e-04,3.7503e-04,5.8472e-04,4.6971e-04,4.1194e-04,4.3344e-04,6.8077e-04,6.5523e-04,5.1395e-04,6.6716e-04,5.2751e-04,6.0577e-04,6.5764e-04,4.3409e-04,3.6499e-04,3.2026e-04,4.0487e-04,3.7030e-04,1.5659e-04,2.6892e-04,4.8944e-04,6.8573e-04,4.7352e-04,2.7511e-04,3.4604e-04,1.1917e-04,8.1698e-06,1.2402e-04,1.9663e-04,4.6044e-05,-1.1343e-04,-1.1816e-04,-1.8251e-04,-2.2553e-04,-1.7371e-04,-1.7097e-04,-1.9040e-04,-2.6817e-04,-2.1703e-04,-1.2118e-04,-3.3258e-05,-3.9024e-05,1.6833e-05,-2.2128e-05,-2.2976e-04,-1.8029e-04,-1.2924e-05,9.7795e-05,7.9048e-05,7.3417e-05,3.9488e-05,-2.9436e-05,1.1222e-04,2.8428e-04,3.7474e-04,4.1447e-04,4.4161e-04,5.2891e-04,4.1071e-04,3.9990e-04,5.0971e-04,3.9958e-04,3.1390e-04,1.8337e-04,1.3350e-04,4.1766e-05,2.2645e-04,4.2687e-04,3.6529e-04,6.0352e-04,3.8012e-04,3.3562e-04,5.7233e-04,3.7912e-04,4.4019e-04,4.5033e-04,2.2137e-04,1.4544e-04,1.5841e-04,2.4514e-04,3.0094e-04,2.0360e-04,2.1795e-04,2.1880e-04,1.3686e-04,8.4381e-05,-2.0632e-04,-4.4806e-04,-3.7264e-04,-1.6559e-04,-1.2439e-04,-2.2551e-04,6.1904e-06,2.2648e-05,-8.8373e-05,-2.4656e-04,-3.4156e-04,-2.6140e-04,-3.2966e-04,-3.8070e-04,-5.4798e-04,-4.7141e-04,-4.2044e-04,-5.9881e-04,-4.5091e-04,-3.4970e-04,-3.0157e-04,-2.6109e-04,-3.3970e-04,-5.9809e-04,-8.9018e-04,-8.1710e-04,-9.1501e-04,-8.9850e-04,-7.8240e-04,-8.0318e-04,-7.1041e-04,-4.4068e-04,-3.9196e-04,-4.2362e-04,-3.0695e-04,-1.9701e-04,-2.5313e-04,-3.7641e-04,-1.9058e-04,-3.2718e-04,-4.0794e-04,-2.3094e-04,-2.2008e-04,-1.5119e-04,-7.8166e-05,-1.2817e-04,-8.4628e-05,5.0364e-05,7.7172e-05,1.2959e-05,-1.2447e-05,1.0295e-04,-1.8395e-05,-8.7119e-05,1.0141e-04,1.9878e-04,2.6551e-04,2.3640e-04,2.1399e-05,-6.2619e-05,-2.9468e-04,-3.6889e-04,-2.6875e-04,-4.3687e-04,-3.3197e-04,-3.7456e-04,-3.1767e-04,-2.1875e-04,-1.5941e-04,-4.2937e-05,-3.0051e-04,-5.5500e-04,-5.6229e-04,-6.2611e-04,-6.5258e-04,-4.1860e-04,-4.7359e-04,-6.0553e-04,-7.0520e-04,-8.0955e-04,-6.8358e-04,-7.6162e-04,-7.6341e-04,-6.1335e-04,-7.0575e-04,-8.1445e-04,-8.9672e-04,-8.6217e-04,-7.6822e-04,-9.7393e-04,-1.0762e-03,-8.5518e-04,-7.7222e-04,-7.2798e-04,-7.2070e-04,-6.9357e-04,-8.2987e-04,-9.2091e-04,-8.6067e-04,-9.8185e-04,-7.8328e-04,-7.3979e-04,-8.8354e-04,-7.3962e-04,-5.8332e-04,-5.3599e-04,-6.7213e-04,-7.0166e-04,-5.5729e-04,-7.0625e-04,-5.9244e-04,-3.5204e-04,-2.2327e-04,2.8870e-05,-3.6111e-06,-1.7230e-04,-8.9908e-05,-9.7495e-05,3.1020e-05,5.8844e-05,-1.6587e-04,4.0871e-05,-2.7675e-05,-1.3823e-04,7.0817e-05,4.8415e-05,1.0278e-04,-2.1188e-05,-2.0530e-04,-1.8086e-04,-1.5222e-04,-1.1990e-04,-2.1015e-05,3.2813e-05,-1.0125e-06,1.6416e-04,1.6888e-04,-2.8841e-05,-1.9653e-04,-1.6819e-05,2.7817e-05,-3.4038e-04,-3.4973e-04,-3.3152e-04,-4.0775e-04,-5.1145e-04,-5.2316e-04,-3.6404e-04,-2.4253e-04,-1.8749e-04,-2.8292e-04,-2.9388e-04,-2.5288e-06,1.3808e-04,-1.1345e-04,-6.3793e-05,6.8156e-05,7.8283e-05,2.4681e-04,2.1926e-04,2.6154e-04,3.5093e-04,2.0054e-04,2.6478e-04,4.2406e-04,2.5299e-04,3.3246e-04,3.9988e-04,2.3849e-04,2.1566e-04,8.1969e-05,3.1074e-04,6.5234e-04,4.9912e-04,4.8947e-04,5.5184e-04,4.9162e-04,6.2692e-04,7.5907e-04,6.1382e-04,5.6439e-04,7.0446e-04,7.8655e-04,8.7607e-04,9.0711e-04,1.0640e-03,1.0553e-03,8.1350e-04,6.8479e-04,7.8245e-04,9.3467e-04,9.9352e-04,9.6216e-04,9.3182e-04,9.7516e-04,1.0010e-03,1.0991e-03,8.8210e-04,7.5169e-04,8.4646e-04,8.7553e-04,9.9864e-04,8.3738e-04,8.1629e-04,9.1811e-04,7.6346e-04,7.6649e-04,6.7141e-04,5.3158e-04,5.1430e-04,3.4949e-04,1.6901e-04,2.2297e-04,3.3926e-04,4.9828e-04,5.2399e-04,5.0257e-04,5.8562e-04,6.2532e-04,5.0719e-04,4.5445e-04,5.6926e-04,6.2069e-04,5.7416e-04,3.8369e-04,4.3854e-04,7.0968e-04,8.1226e-04,7.0568e-04,6.2403e-04,9.4347e-04,9.1162e-04,5.7711e-04,6.4715e-04,8.1748e-04,1.0157e-03,8.5950e-04,6.8609e-04,7.7155e-04,8.7065e-04,1.0191e-03,1.0032e-03,9.4492e-04,9.3616e-04,9.4024e-04,7.2080e-04,7.5630e-04,9.1599e-04,7.3156e-04,7.7341e-04,7.1738e-04,5.0627e-04,5.1059e-04,4.7857e-04,4.7668e-04,2.2876e-04,1.0938e-04,9.3427e-05,-1.7084e-04,7.2112e-05,2.6809e-04,4.6212e-05,-1.1711e-04,-7.1398e-05,1.6241e-05,-2.9869e-06,-2.5302e-05,6.3536e-06,9.4773e-05,2.0670e-04,1.2047e-04,1.3003e-05,2.8626e-04,4.5810e-04,1.9042e-04,2.6440e-04,5.5018e-04,5.2352e-04,5.3953e-04,4.9228e-04,5.1999e-04,4.7823e-04,4.7582e-04,6.2962e-04,5.2473e-04,5.4688e-04,6.2926e-04,4.7515e-04,2.6682e-04,1.7412e-04,3.1112e-04,6.5113e-04,9.3542e-04,1.0546e-03,9.6103e-04,1.4217e-04,-9.6615e-04,-1.4726e-03,-1.4508e-03,-1.1545e-03,-9.7177e-04,-1.3870e-03,-1.7038e-03,-1.2534e-03,-9.6533e-04,-1.1673e-03,-1.2526e-03,-6.7913e-04,-1.7527e-04,-1.0282e-04,-5.0341e-04,-7.8133e-04,-6.0345e-04,-3.2340e-04,-1.3714e-04,-3.9584e-04,-4.3197e-04,-6.5737e-05,3.1699e-04,3.3402e-04,3.0718e-04,2.6456e-04,3.2600e-04,5.7307e-04,5.9456e-04,4.9007e-04,3.6511e-04,3.3676e-04,3.4576e-04,2.3942e-04,6.1343e-04,9.0919e-04,9.2758e-04,7.7294e-04,4.4197e-04,3.8625e-04,4.8520e-04,6.4248e-04,5.0390e-04,5.0419e-04,7.2547e-04,6.4540e-04,4.7361e-04,4.0204e-04,3.6255e-04,4.8272e-04,4.6633e-04,4.3523e-04,2.9638e-04,2.8343e-04,4.5269e-04,4.5994e-04,4.2878e-04,3.1853e-04,3.5776e-04,3.9544e-04,3.1190e-04,1.5761e-04,8.6796e-05,-1.8614e-05,1.1533e-04,2.2378e-04,-2.0706e-05,-1.6424e-04,-1.3479e-04,-1.1455e-05,1.1328e-04,-1.3663e-04,-6.6755e-04,-9.0284e-04,-5.2825e-04,-5.4041e-04,-1.4215e-03,-1.3731e-03,-1.0719e-03,-1.4526e-03,-1.4662e-03,-1.4669e-03,-1.6916e-03,-1.5774e-03,-1.7327e-03,-2.5021e-03,-2.4313e-03,-1.6837e-03,-1.8276e-03,-2.4229e-03,-2.8283e-03,-2.7667e-03,-2.1168e-03,-1.7366e-03,-2.2901e-03,-2.7380e-03,-2.5388e-03,-2.5855e-03,-2.8407e-03,-2.9326e-03,-2.9010e-03,-3.1785e-03,-3.3401e-03,-3.1752e-03,-3.5888e-03,-4.1213e-03,-3.7978e-03,-3.4181e-03,-3.6106e-03,-3.5878e-03,-3.5219e-03,-3.6636e-03,-3.7297e-03,-3.7011e-03,-3.7214e-03,-3.8060e-03,-3.8575e-03,-4.0104e-03,-4.1652e-03,-4.2174e-03,-4.2697e-03,-4.2445e-03,-4.1188e-03,-4.1858e-03,-4.3676e-03,-4.3360e-03,-4.4822e-03,-4.9764e-03,-5.1420e-03,-4.9418e-03,-4.9755e-03,-5.0052e-03,-4.7726e-03,-4.5952e-03,-4.7095e-03,-4.8044e-03,-4.8093e-03,-4.7464e-03,-4.6502e-03,-4.5576e-03,-4.2114e-03,-4.2606e-03,-4.4622e-03,-4.1898e-03,-3.6905e-03,-3.3722e-03,-3.3651e-03,-3.2031e-03,-2.9572e-03,-2.7611e-03,-2.5522e-03,-2.2272e-03,-1.9679e-03,-1.8485e-03,-1.5875e-03,-1.2107e-03,-6.9511e-04,-3.2740e-04,4.2428e-05,3.6664e-04,3.7415e-04,6.4889e-04,1.0875e-03,1.5940e-03,1.9917e-03,2.2425e-03,2.6994e-03,2.9240e-03,3.1970e-03,3.6781e-03,4.0991e-03,4.4703e-03,4.8283e-03,5.2373e-03,5.5042e-03,5.7838e-03,6.2128e-03,6.5341e-03,6.8081e-03,7.1845e-03,7.5361e-03,7.8963e-03,8.0334e-03,8.4369e-03,8.8194e-03,8.8777e-03,9.0734e-03,9.1254e-03,9.2547e-03,9.4510e-03,9.5858e-03,9.7577e-03,9.6524e-03,9.7421e-03,9.7927e-03,9.6601e-03,9.9387e-03,9.9584e-03,9.7171e-03,9.6324e-03,9.7971e-03,9.7767e-03,9.3653e-03,9.1510e-03,9.1128e-03,9.0415e-03,8.8827e-03,8.5800e-03,8.3912e-03,8.4025e-03,8.2847e-03,8.0631e-03,7.9431e-03,7.6237e-03,7.2285e-03,7.1322e-03,6.8804e-03,6.6950e-03,6.6125e-03,6.4525e-03,6.2629e-03,5.8131e-03,5.7735e-03,5.9172e-03,5.5721e-03,5.1731e-03,4.8322e-03,4.7035e-03,4.6914e-03,4.4952e-03,4.2316e-03,4.0566e-03,3.8329e-03,3.5958e-03,3.4431e-03,3.0955e-03,3.0331e-03,3.0741e-03,2.8912e-03,2.6678e-03,2.3216e-03,2.3289e-03,2.6473e-03,2.5762e-03,2.1214e-03,1.8620e-03,1.8608e-03,1.7043e-03,1.5708e-03,1.4682e-03,1.3143e-03,9.9894e-04,6.3645e-04,5.7543e-04,3.7650e-04,6.4450e-05,-2.3234e-04,-5.9165e-04,-8.7817e-04,-1.2694e-03,-1.5793e-03,-1.7573e-03,-2.0289e-03,-2.2450e-03,-2.6077e-03,-2.9392e-03,-3.1825e-03,-3.2967e-03,-3.1709e-03,-3.3888e-03,-3.8995e-03,-4.2095e-03,-4.2867e-03,-4.3971e-03,-4.5399e-03,-4.6242e-03,-4.7158e-03,-4.9806e-03,-5.2774e-03,-5.3960e-03,-5.5945e-03,-5.5601e-03,-5.6708e-03,-6.0803e-03,-6.1941e-03,-6.4970e-03,-6.5422e-03,-6.3410e-03,-6.7939e-03,-7.0738e-03,-7.0674e-03,-7.1653e-03,-7.4111e-03,-7.7935e-03,-7.8541e-03,-7.8393e-03,-8.0324e-03,-8.2034e-03,-8.1912e-03,-8.0484e-03,-7.9095e-03,-7.8921e-03,-8.0636e-03,-8.1210e-03,-8.2095e-03,-8.1304e-03,-8.0636e-03,-8.2679e-03,-8.3850e-03,-8.4884e-03,-8.3378e-03,-8.1536e-03,-8.1545e-03,-8.0242e-03,-7.9316e-03,-7.8707e-03,-7.7842e-03,-7.6505e-03,-7.5662e-03,-7.7535e-03,-7.7919e-03,-7.5709e-03,-7.5427e-03,-7.4667e-03,-7.2524e-03,-7.2435e-03,-7.1651e-03,-6.8685e-03,-6.6203e-03,-6.4436e-03,-6.3699e-03,-6.0505e-03,-5.8729e-03,-5.9191e-03,-5.6636e-03,-5.7045e-03,-5.6105e-03,-5.4032e-03,-5.4140e-03,-5.0824e-03,-4.7349e-03,-4.5391e-03,-4.3151e-03,-4.2196e-03,-4.2434e-03,-4.2876e-03,-4.2591e-03,-4.1190e-03,-3.8413e-03,-3.6273e-03,-3.7255e-03,-3.4930e-03,-3.0715e-03,-2.9298e-03,-2.8500e-03,-2.7012e-03,-2.5137e-03,-2.3480e-03,-2.2889e-03,-2.3347e-03,-2.1292e-03,-1.9331e-03,-1.7560e-03,-1.6869e-03,-1.6670e-03,-1.4291e-03,-1.2379e-03,-1.1261e-03,-1.2014e-03,-1.2539e-03,-9.7313e-04,-7.0165e-04,-6.8114e-04,-5.8468e-04,-4.0518e-04,-2.6892e-04,-2.1761e-04,-2.1159e-04,5.4399e-05,2.9004e-04,4.5335e-04,4.6432e-04,5.2510e-04,7.0535e-04,6.5173e-04,6.9040e-04,8.8185e-04,1.0519e-03,1.0440e-03,9.3939e-04,1.0320e-03,1.2244e-03,1.3789e-03,1.4789e-03,1.4795e-03,1.5422e-03,1.6861e-03,1.7457e-03,1.8482e-03,1.9552e-03,1.8693e-03,1.7270e-03,1.8815e-03,2.0778e-03,2.2908e-03,2.3945e-03,2.2585e-03,2.3277e-03,2.4891e-03,2.5803e-03,2.6119e-03,2.5948e-03,2.6978e-03,2.7581e-03,2.8201e-03,2.9284e-03,3.1290e-03,3.3585e-03,3.4043e-03,3.4534e-03,3.4122e-03,3.4626e-03,3.6642e-03,3.7747e-03,3.9956e-03,4.1922e-03,4.2443e-03,4.4426e-03,4.6355e-03,4.6848e-03,4.7769e-03,4.6432e-03,4.7396e-03,4.9172e-03,4.8792e-03,4.9167e-03,4.9381e-03,5.0685e-03,4.9497e-03,4.8494e-03,4.8060e-03,4.8717e-03,4.9617e-03,4.7393e-03,4.6371e-03,4.6380e-03,4.7151e-03,4.6691e-03,4.5293e-03,4.5963e-03,4.6701e-03,4.7675e-03,4.6476e-03,4.4043e-03,4.3874e-03,4.3942e-03,4.3312e-03,4.1737e-03,4.1595e-03,4.1896e-03,4.1231e-03,4.1467e-03,4.1600e-03,4.1287e-03,3.9943e-03,3.8198e-03,3.8273e-03,3.9019e-03,3.7894e-03,3.7116e-03,3.6976e-03,3.5406e-03,3.5785e-03,3.4677e-03,3.4393e-03,3.4993e-03,3.3704e-03,3.3821e-03,3.2309e-03,3.1543e-03,3.3604e-03,3.3863e-03,3.2892e-03,3.2326e-03,3.3020e-03,3.4616e-03,3.3327e-03,3.1305e-03,3.1229e-03,3.3428e-03,3.2504e-03,3.0850e-03,2.9832e-03,3.0811e-03,3.3779e-03,3.2899e-03,3.1131e-03,3.0382e-03,3.0885e-03,3.1174e-03,3.0047e-03,2.9148e-03,2.9829e-03,2.8932e-03,2.6927e-03,2.5571e-03,2.7136e-03,2.7157e-03,2.4508e-03,2.3834e-03,2.3472e-03,2.3445e-03,2.2735e-03,2.1103e-03,2.1272e-03,2.2070e-03,2.0853e-03,2.0658e-03,2.0625e-03,1.9083e-03,1.7917e-03,1.8904e-03,1.9129e-03,1.7761e-03,1.7404e-03,1.7405e-03,1.9175e-03,1.7827e-03,1.4351e-03,1.3323e-03,1.3753e-03,1.4061e-03,1.2730e-03,1.1139e-03,1.0318e-03,9.8620e-04,9.3888e-04,8.7620e-04,9.5559e-04,7.9025e-04,5.9435e-04,5.6578e-04,3.6224e-04,2.7896e-04,2.5555e-04,2.6912e-04,1.2350e-04,5.1237e-07,7.3441e-05,-1.4341e-04,-2.1433e-04,6.9245e-05,9.4135e-05,-5.4641e-05,-1.4368e-04,-1.7850e-04,2.9091e-05,2.2501e-05,-1.4914e-04,-1.3849e-04,-9.6931e-05,3.9562e-05,-5.2681e-05,-1.0335e-04,9.1747e-05,1.7300e-04,3.9806e-04,3.0553e-04,4.1588e-05,2.2493e-05,7.6212e-05,9.3118e-05,-1.3615e-04,-1.0624e-04,-1.8275e-05,-1.1109e-04,-1.7826e-04,-4.0811e-04,-4.8192e-04,-8.3552e-04,-1.1656e-03,-1.1962e-03,-1.1467e-03,-1.0270e-03,-1.1863e-03,-1.3045e-03,-1.1357e-03,-7.9942e-04,-6.9899e-04,-8.8359e-04,-9.4313e-04,-7.4511e-04,-6.9221e-04,-8.3672e-04,-9.5855e-04,-8.8159e-04,-7.5120e-04,-9.3223e-04,-1.1783e-03,-1.2736e-03,-1.3385e-03,-1.4023e-03,-1.4218e-03,-1.3993e-03,-1.2898e-03,-1.1728e-03,-1.4161e-03,-1.7211e-03,-1.7138e-03,-1.6827e-03,-1.8235e-03,-1.9043e-03,-1.7362e-03,-1.6126e-03,-1.6470e-03,-1.6290e-03,-1.6124e-03,-1.5313e-03,-1.4509e-03,-1.4223e-03,-1.5341e-03,-1.5358e-03,-1.3273e-03,-1.3057e-03,-1.4226e-03,-1.5462e-03,-1.4366e-03,-1.2636e-03,-1.3091e-03,-1.5579e-03,-1.6806e-03,-1.7017e-03,-1.8242e-03,-1.9459e-03,-2.0116e-03,-1.9152e-03,-1.8014e-03,-1.9807e-03,-2.0682e-03,-2.0855e-03,-2.2002e-03,-2.2447e-03,-2.3655e-03,-2.5527e-03,-2.6519e-03,-2.7566e-03,-2.8988e-03,-2.9600e-03,-2.9586e-03,-2.8486e-03,-2.8721e-03,-3.0242e-03,-2.9794e-03,-2.9980e-03,-3.0401e-03,-3.0564e-03,-3.1203e-03,-3.0159e-03,-3.0103e-03,-3.0833e-03,-3.2006e-03,-3.3847e-03,-3.4708e-03,-3.6551e-03,-3.7231e-03,-3.6740e-03,-3.8629e-03,-3.9187e-03,-4.0058e-03,-4.1194e-03,-4.1263e-03,-4.2047e-03,-4.2712e-03,-4.4689e-03,-4.3734e-03,-4.3208e-03,-4.5538e-03,-4.4960e-03,-4.4443e-03,-4.5034e-03,-4.5015e-03,-4.5384e-03,-4.4227e-03,-4.4417e-03,-4.7737e-03,-4.4490e-03,-4.4298e-03,-4.5766e-03,-4.4333e-03,-4.3650e-03,-4.3000e-03,-4.3873e-03,-4.2847e-03,-4.2912e-03,-4.3044e-03,-4.2626e-03,-4.2725e-03,-4.3302e-03,-4.3364e-03,-4.2516e-03,-4.1770e-03,-3.9783e-03,-4.0120e-03,-3.9724e-03,-3.7459e-03,-3.7230e-03,-3.6975e-03,-3.4977e-03,-3.3495e-03,-3.3262e-03,-3.2411e-03,-3.2157e-03,-3.0494e-03,-2.9746e-03,-2.8794e-03,-2.7759e-03,-2.7124e-03,-2.6066e-03,-2.5623e-03,-2.3223e-03,-2.1898e-03,-2.0821e-03,-2.0484e-03,-1.9461e-03,-1.6306e-03,-1.4868e-03,-1.4760e-03,-1.3637e-03,-1.3816e-03,-1.2468e-03,-1.0582e-03,-9.8027e-04,-8.4209e-04,-7.4101e-04,-6.0311e-04,-5.5111e-04,-2.3874e-04,-9.0588e-05,-2.0883e-04,-1.7978e-04,-2.2065e-04,-2.1753e-04,2.5855e-04,4.6526e-04,2.2574e-04,3.6292e-04,5.0086e-04,3.9121e-04,5.0033e-04,5.1012e-04,5.6771e-04,7.6745e-04,8.4568e-04,7.6500e-04,7.0922e-04,9.4616e-04,9.1621e-04,1.0733e-03,1.1880e-03,1.1533e-03,1.3932e-03,1.5808e-03,1.5917e-03,1.4867e-03,1.7607e-03,1.7966e-03,1.5352e-03,1.6252e-03,1.7632e-03,1.8119e-03,1.7326e-03,1.7264e-03,1.9976e-03,2.0452e-03,1.9803e-03,1.9810e-03,1.9733e-03,2.0437e-03,2.2340e-03,2.3698e-03,2.3042e-03,2.2618e-03,2.4603e-03,2.6718e-03,2.6911e-03,2.6727e-03,2.6750e-03,2.6696e-03,2.4551e-03,2.5053e-03,2.6143e-03,2.6177e-03,2.6257e-03,2.5921e-03,2.6543e-03,2.6617e-03,2.6136e-03,2.4574e-03,2.5902e-03,2.6356e-03,2.5502e-03,2.5715e-03,2.6859e-03,2.5940e-03,2.4441e-03,2.5273e-03,2.4461e-03,2.3780e-03,2.4376e-03,2.3935e-03,2.4319e-03,2.5286e-03,2.3233e-03,2.1507e-03,2.2083e-03,2.4468e-03,2.3655e-03,2.2694e-03,2.4452e-03,2.4959e-03,2.5830e-03,2.6228e-03,2.4803e-03,2.3439e-03,2.2532e-03,2.1522e-03,2.0141e-03,2.0369e-03,2.0813e-03,2.0939e-03,2.0571e-03,2.0715e-03,2.1538e-03,2.0222e-03,2.0135e-03,1.9818e-03,1.8651e-03,1.9795e-03,1.8889e-03,1.9373e-03,2.0758e-03,2.0510e-03,2.0458e-03,1.7976e-03,1.8381e-03,1.8974e-03,1.9050e-03,1.9885e-03,1.7962e-03,1.8635e-03,2.0601e-03,2.0242e-03,1.9667e-03,1.9482e-03,2.0888e-03,2.1512e-03,1.9486e-03,1.8565e-03,1.8313e-03,2.0045e-03,2.2552e-03,2.0565e-03,1.8245e-03,1.9880e-03,2.0823e-03,1.7988e-03,1.6042e-03,1.7772e-03,1.9161e-03,1.9831e-03,1.9198e-03,1.7996e-03,1.9512e-03,1.7187e-03,1.4680e-03,1.5854e-03,1.5655e-03,1.4244e-03,1.4603e-03,1.4332e-03,1.3402e-03,1.5440e-03,1.4995e-03,1.3337e-03,1.2526e-03,1.2569e-03,1.3282e-03,1.3896e-03,1.4345e-03,1.3030e-03,1.2317e-03,1.1969e-03,1.0685e-03,1.0786e-03,1.2014e-03,9.6813e-04,8.6500e-04,1.0154e-03,1.0574e-03,1.0107e-03,8.7439e-04,1.0081e-03,9.2967e-04,9.6508e-04,9.4581e-04,8.0612e-04,9.7354e-04,1.0520e-03,9.3697e-04,7.8881e-04,8.9393e-04,8.7600e-04,9.0260e-04,9.1519e-04,7.4894e-04,9.7576e-04,1.0104e-03,9.2709e-04,9.9643e-04,9.1082e-04,8.2438e-04,8.0778e-04,8.8142e-04,7.3880e-04,6.2012e-04,9.3258e-04,7.2304e-04,5.1364e-04,7.7903e-04,5.4007e-04,5.4237e-04,6.4110e-04,4.3419e-04,2.9783e-04,3.0442e-04,1.8052e-04,2.3148e-04,4.0605e-04,1.2631e-04,1.6239e-04,3.1846e-04,4.0302e-04,5.6148e-04,5.6896e-04,5.6403e-04,5.8560e-04,5.0961e-04,4.5172e-04,5.0056e-04,3.4147e-04,2.1572e-04,3.3491e-04,2.6367e-04,-3.3060e-05,-1.8364e-04,-1.2740e-04,-1.2400e-04,-3.4259e-04,-5.1249e-04,-3.3095e-04,-3.7859e-04,-4.4752e-04,-1.8228e-04,-4.0388e-04,-5.6421e-04,-4.3361e-04,-7.8590e-04,-9.4329e-04,-8.0489e-04,-9.8137e-04,-9.6226e-04,-7.9884e-04,-8.0000e-04,-8.5319e-04,-1.0012e-03,-1.0880e-03,-1.0874e-03,-8.7008e-04,-9.8101e-04,-1.3075e-03,-1.3784e-03,-1.2175e-03,-1.1329e-03,-1.2547e-03,-1.3691e-03,-1.3859e-03,-1.2932e-03,-1.6158e-03,-1.6839e-03,-1.6015e-03,-1.7329e-03,-1.6995e-03,-1.5243e-03,-1.4203e-03,-1.4087e-03,-1.1903e-03,-1.2742e-03,-1.3679e-03,-1.0644e-03,-9.4615e-04,-1.2045e-03,-1.4542e-03,-1.0421e-03,-1.0262e-03,-1.2220e-03,-9.2805e-04,-1.0289e-03,-1.0751e-03,-8.0977e-04,-9.5112e-04,-1.1615e-03,-8.3770e-04,-1.0786e-03,-1.4308e-03,-1.1767e-03,-1.1472e-03,-1.3325e-03,-1.3758e-03,-1.3259e-03,-1.4472e-03,-1.4711e-03,-1.2893e-03,-1.4775e-03,-1.6703e-03,-1.7045e-03,-1.6118e-03,-1.7287e-03,-1.9009e-03,-1.7108e-03,-1.5102e-03,-1.6328e-03,-1.8596e-03,-1.7564e-03,-1.7332e-03,-1.7713e-03,-1.9215e-03,-1.8895e-03,-1.8289e-03,-1.9676e-03,-1.9250e-03,-1.8248e-03,-1.9418e-03,-2.0182e-03,-1.8978e-03,-1.8002e-03,-1.6796e-03,-1.6487e-03,-1.7294e-03,-1.5915e-03,-1.5827e-03,-1.7797e-03,-1.7950e-03,-1.6882e-03,-1.5442e-03,-1.5048e-03,-1.5776e-03,-1.6533e-03,-1.6374e-03,-1.7062e-03,-1.8173e-03,-1.7890e-03,-1.8856e-03,-1.7247e-03,-1.4433e-03,-1.5065e-03,-1.3223e-03,-1.3027e-03,-1.4500e-03,-1.2326e-03,-1.1332e-03,-1.2431e-03,-1.1384e-03,-1.0693e-03,-1.0165e-03,-7.0013e-04,-7.1974e-04,-8.2251e-04,-6.2860e-04,-7.9571e-04,-9.2496e-04,-8.6888e-04,-8.6722e-04,-7.7971e-04,-6.4444e-04,-6.3196e-04,-6.4471e-04,-6.7162e-04,-5.8101e-04,-7.5004e-04,-8.3665e-04,-4.8651e-04,-5.5996e-04,-5.7665e-04,-3.4360e-04,-3.5989e-04,-5.5585e-04,-4.8692e-04,-4.3757e-04,-6.1053e-04,-7.5046e-04,-6.4595e-04,-4.8720e-04,-6.9472e-04,-6.2282e-04,-6.0640e-04,-6.9031e-04,-6.6460e-04,-7.9435e-04,-6.7851e-04,-5.1148e-04,-4.3766e-04,-3.5375e-04,-2.4799e-04,-2.0383e-04,-2.7870e-04,-4.1473e-04,-4.5249e-04,-1.8113e-04,-4.0889e-04,-3.4794e-04,4.9152e-05,-1.5306e-04,-1.7760e-04,-1.0104e-05,7.9216e-05,-1.7391e-04,-1.4657e-04,2.8957e-05,-1.5373e-04,-5.0837e-05,2.0136e-04,9.2486e-05,1.8863e-04,2.6575e-04,5.3331e-05,3.6635e-05,2.0016e-04,1.1881e-04,8.1342e-05,3.2391e-04,4.1546e-04,3.1017e-04,4.9756e-04,7.3303e-04,5.3877e-04,5.9165e-04,7.1038e-04,8.4920e-04,8.1526e-04,9.6608e-04,1.2389e-03,1.0013e-03,1.0091e-03,1.1278e-03,1.1160e-03,9.3014e-04,9.0587e-04,9.0547e-04,9.3878e-04,1.1740e-03]

        let melSpectrogram = samples.melspectrogram(nFFT: 400, hopLength: 160, sampleRate: Int(SAMPLE_RATE), melsCount: 80)
        // values are the same as in Android! except the size is 80x21 on iOS and 21x80 on Android
        
//        var floatArray = Array(UnsafeBufferPointer(start: buffer.floatChannelData![0], count:Int(buffer.frameLength)))
        print("before recognize")
        DispatchQueue.global().async {
            floatArray.withUnsafeMutableBytes {
                let result = self.module.recognize($0.baseAddress!, chunkToRead: Int32(CHUNK_TO_READ), chunkSize: Int32(CHUNK_SIZE))
                print(result)

            }
        }

        /*
        DispatchQueue.global().async {

            var chunkToRead = self.CHUNK_TO_READ
            var recordingOffset = 0
            
            //short[] recordingBuffer = new short[CHUNK_TO_READ*CHUNK_SIZE];
            //double[] floatInputBuffer = new double[CHUNK_TO_READ * CHUNK_SIZE];

            while self.mListening {

                var shortsRead = 0
                var audioBuffer = Array(repeating: 0.0, count: 960)

                while shortsRead < chunkToRead * self.CHUNK_SIZE {
                    
                    // for every segment of 5 chunks of data, we perform transcription
                    // each successive segment’s first chunk is exactly the preceding segment’s last chunk
                    let numberOfShort = 1000 // record.read(audioBuffer, 0, audioBuffer.length);
                    shortsRead += numberOfShort
                    if shortsRead > chunkToRead * self.CHUNK_SIZE {
                        //System.arraycopy(audioBuffer, 0, recordingBuffer, recordingOffset, (int) (numberOfShort - (shortsRead - chunkToRead*640)));
                    }
                    else {
                        //System.arraycopy(audioBuffer, 0, recordingBuffer, recordingOffset, numberOfShort);
                    }

                    recordingOffset += numberOfShort
                }

                for i in 0...self.CHUNK_TO_READ * self.CHUNK_SIZE - 1{
                    //floatInputBuffer[i] = recordingBuffer[i] / (float)Short.MAX_VALUE;
                }

                //final String result = recognize(floatInputBuffer);
                //if result.length() > 0 {
                    //all_result = String.format("%s %s", all_result, result)
                //}
                let all_result = "aa"

                chunkToRead = self.CHUNK_TO_READ - 1
                recordingOffset = self.CHUNK_SIZE;
                //System.arraycopy(recordingBuffer, chunkToRead * CHUNK_SIZE, recordingBuffer, 0, CHUNK_SIZE);

                 floatArray.withUnsafeMutableBytes {
                     let result = self.module.recognize($0.baseAddress!, bufLength: Int32(self.AUDIO_LEN_IN_SECOND * self.SAMPLE_RATE))
                     
                     DispatchQueue.main.async {
                         self.tvResult.text = result
                         self.btnStart.setTitle("Start", for: .normal)
                     }
                }
            }
            

        }*/
        
        //self.recognitionRequest.append(buffer)
        
        // this runs too but the recognition result is incorrect
        //self.recognitionRequest.append(pcmBuffer!)
        
//        (lldb) po buffer
//        <AVAudioPCMBuffer@0x283799940: 17640/17640 bytes>
//
//        (lldb) po pcmBuffer
//        ▿ Optional<AVAudioPCMBuffer>
//          - some : <AVAudioPCMBuffer@0x283799700: 64000/64000 bytes>
//
//        (lldb) po buffer.frameLength
//        4410
//
//        (lldb) po pcmBuffer!.frameLength
//        16000
        
    }

    audioEngine.prepare()
    try audioEngine.start()
      
//    recognitionTask = speechRecognizer?.recognitionTask(with: recognitionRequest) {
//      [unowned self]
//      (result, _) in
//      if let transcription = result?.bestTranscription {
//          //print(transcription)
//          print(transcription.formattedString)
//          tvResult.text = transcription.formattedString
//      }
//    }
  }

  fileprivate func stopRecording() {
    audioEngine.stop()
    recognitionRequest.endAudio()
    recognitionTask?.cancel()
  }
}
